# Regular Expression

匹配一类字符串的公式

## 简介

正则表达式存在多种实现引擎和风格

preg_ PCRE库提供

ereg_ POSIX 扩展提供(非二进制安全，不推荐使用)

### 组成

**分隔符** /, !, #, %, |, ~

**表达式** 

**修饰符** 开启或关闭某些功能

### 测试工具

- RegexTester
- Regular Expression Tester (Firefox)

## 元字符

正则表达式中具有特殊意义的专用字符，用于规定其前导字符在目标对象中出现的模式

### 位置

| 符号|  解释    |
|-----|----------|
| ^   |字符串开始|
| $   |字符串结束|
| \b  | 单词的开始或结束 |

### 元字符

|符号|  解释  |  符号|  解释  |
|----|--------|------|--------|
| .  | 换行符外任意字符     | \w | 字母、数字、下划线、汉字 |
| \s | 任意空白字符         | \d | 数字 |
| -  | 表示范围 | [] | 括号中的任意一个字符 |

### 量词

| 符号|  解释  |  符号|  解释  |
|-----|--------|------|--------|
| * | 重复 0 次或更多次   | {n}    | 重复 n 次 |
| + | 重复 1 次或更多次   | {n,}   | 重复 n 次或更多次 |
| ? | 重复 0 次或 1 次    | {n, m} | 重复 n 到 m 次 |

## 匹配规则

### 字符组

匹配未预定义元字符的字符集合

[] 匹配一个字符 `[aeiou] 匹配一个元音字符`

### 转义

防止字符被解析

\ 转义字符,
\Q...\E \Q和\E间的元字符作为普通字符来匹配 `\Q.$.\E `

### 反义

查找的字符不属于某个字符类

| 符号|  解释  |  符号|  解释  |
|-----|--------|------|--------|
| \W | 任意不是字母、数字、下划线、汉字的字符 | \S | 任意不是空白字符的字符 |
| \D | 任意非数字 | \B | 匹配不是单词开头或结尾的位置 |
| \[^x\] | 匹配除x 外任意字符 | \[^aeiou\] | 匹配除aeiou外任意字符 |

### 分支

字符组增强，匹配多种可能

`(c|h|f|to)at` 匹配 cat, hat, fat, toat
`\d{5}-\d{4}|\d{5}` 匹配用 - 间隔的9位数字，或者5位数字 (要注意分支的顺序)

### 分组

| 符号|  解释  |  符号|  解释  |
|-----|--------|------|--------|
| (exp) | 匹配exp,并捕获文本到自动命名组| (?<name>exp) | 匹配exp,并捕获文本到name组 |
| (?:exp) | 匹配exp,不捕获文本 | (?#comment) | 注释 |
| (?=exp) | 匹配exp前面的位置 | (?<=exp) | 匹配exp后面的位置 |
| (?!exp) | 匹配匹配后面不是exp的位置 | (?<!exp) | 匹配前面不是exp的位置 |

`(\d{1,3}\.){3}\d{1,3}` 匹配IP地址

### 反向引用

反向引用用于重复搜索前面某个分组匹配的文本

`\b(\w+)\b\s+\1\b`  \1反向引用匹配单词

`\b(?<Word>\w+)\b\s+\k<Word>\b` \k<Word>反向引用匹配单词

### 环视

断言匹配，用于查找某些内容之前或之后应该满足的条件.

| 符号|  解释  |  符号|  解释  |
|-----|--------|------|--------|
| (?<=exp) | 匹配exp后面的内容 | (?=exp) | 匹配exp前面的内容 |
| (?!exp) | 匹配匹配后面不是exp的位置 | (?<!exp) | 匹配前面不是exp的位置 |

## 模式

| 符号|  解释  |  符号|  解释   |
|-----|--------|------|---------|
| i | 忽略大小写 | m | 多行模式 |
| s | 点号通配 | U | 懒惰模式 |
| D | 结尾限制 | u | UTF-8 |

- D 不允许匹配换行 `%abc$%D 不匹配 "abc\n"`
- 懒惰模式 可以通过在限定符后加 ? 指定
- 多行模式 忽略字符串中的换行 "\n"
- 点号通配 `.`可以匹配换行符

## 应用

- 手机号 `(13[4-9]|15[01789]|18[238])\d{8}`
- E-mail `^[a-z0-9_\-]+(\.[_a-z0-9\-]+)*@([_a-z0-9\-]+\.)+([a-z]{2}|aero|arpa|biz|com|coop|edu|gov|info|int|jobs|mil|museum|name|nato|net|org|pro|travel)$`
- E-mail `\w{3,16}@\w{1,64}\.\w{2,5}`