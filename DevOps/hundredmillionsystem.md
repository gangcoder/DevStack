# 亿级Web系统搭建：单机到分布式集群

## Web负载均衡

Load Balancing：给服务器集群分配任务

### HTTP重定向策略

Web服务器修改HTTP响应头的Location标记，使浏览器重定向到新url

**优点**

- 实现简单
- 自定义策略

**缺点**

- 大规模访问性能不佳
- 用户体验不好，重定向时网络延时

### 反响代理

反向代理服务转发HTTP请求，作为客户端和后台web服务器中转。

工作在应用层(HTTP)

**优点**

- 实现和部署简单
- 性能好
- 定制化转发策略

**缺点**

- 单点故障
- web服务器增加，反向代理服务器本身成为瓶颈

#### session问题

- 配置反向代理转发规则，使转发落在指定服务器，增加服务器负担
- 独立服务存储

#### 缓存

反向代理可以开启缓存，但是会增加反向代理负担

### IP负载均衡

对IP层的数据包的IP地址和端口信息进行修改，达到负载均衡的目的

工作在网络层（修改IP）和传输层（修改端口，第四层）

常见的负载均衡方式: LVS（Linux Virtual Server，Linux虚拟服务); IPVS（IP Virtual Server，IP虚拟服务）

**优点**

- 性能好

**缺点**

- 配置搭建复杂

### DNF负载均衡

域名url实际上是服务器的别名，实际映射一个IP地址，
解析过程，就是DNS完成域名到IP的映射。而一个域名是可以配置成对应多个IP的

**优点**

- 策略，配置简单
- 性能极佳

**缺点**

- 不能自定义规则
- 更换IP或机器故障很麻烦
- DNS生效延迟

### DNS/GSLB负载均衡

在同一个域名映射为多IP的基础上更进一步，通过GSLB（Global Server Load Balance，全局负载均衡）按照指定规则映射域名的IP，也即CDN

CDN在Web系统中，一般情况下是用来解决大小较大的静态资源（html/Js/Css/图片等）的加载问题，让这些比较依赖网络下载的内容，尽可能离用户更近，提升用户体验

- 性能极佳
- 支持配置多种策略
- 搭建和维护成本非常高

## 缓存机制的建立和优化

Web系统自身的性能问题，随着访问量的上升，会遇到很多的挑战，解决这些问题不仅仅是扩容机器这么简单，建立和使用合适的缓存机制才是根本

### MySQL内部缓存

- 建立恰当索引
- 数据库连接池(swoole)
- 数据库引擎缓存设置
- 分库/分表/分区

### MySQL多台服务器搭建

- 主从，从库作为备份
- 主写，从读
- 主主互备

### 数据库数据同步

- 多线程同步
- 自定义解析binlog，多线程写入

### web服务器与数据库间数据缓存

- 页面静态化
- 单台内存缓存
- 内存缓存集群
- 减少数据库“写”，使用redis队列
- NoSQL存储
- 空节点查询问题

## 异地部署

### 核心集中与节点分散

- 核心集中：实际部署过程中，总有一部分的数据和服务存在不可部署多套，或者部署多套成本巨大
- 节点分散：将一些服务部署为多套，分布在各个城市节点，让用户请求尽可能选择近的节点访问服务

### 节点容灾和过载保护

- 节点容灾是指，某个节点如果发生故障时，我们需要建立一个机制去保证服务仍然可用
- 过载保护，指的是一个节点已经达到最大容量，无法继续接接受更多请求了，系统必须有一个保护的机制


[亿级Web系统搭建：单机到分布式集群](http://blog.jobbole.com/91738/)